os: linux
dist: xenial
services:
  - docker

language: node_js
before_script:
  - wget https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 && mv test-reporter-latest-linux-amd64 cc-test-reporter 
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build
  - docker-compose -f compose/nats.yml up -d
  - mkdir -p coverage
script: npm run test:coverage
after_script:
  - npm run nyc report -- --reporter=text-lcov > coverage/lcov.info
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
  - docker-compose -f compose/nats.yml down
install:
  - npm ci
  - npm run lerna bootstrap
git:
  depth: 3

node_js:
  - "8"
  - "10"
  - "12"
env:
  - NODE_ENV=test

